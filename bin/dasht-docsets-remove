#!/bin/sh -e
#
# Usage: dasht-docsets-remove [NAME...]
#
# Removes installed Dash docsets whose names loosely match the given NAMEs.
# You are asked to confirm this destructive operation for every such match.
#
# If no NAMEs are specified, all installed docsets are selected for removal.
#
# Written in 2016 by Suraj N. Kurapati <https://github.com/sunaku/dasht>
# Distributed under the terms of the ISC license (see the LICENSE file).

: ${DASHT_DOCSETS_DIR:=${XDG_DATA_HOME:-$HOME/.local/share}/dasht/docsets}

set -- $(dasht-docsets "$@")
printf "Removable docsets ($#):\n\n\t%s\n\n" "$(echo "$*" | sed 's/ /,&/g')"

trap exit INT # let Control-C abort `xargs -p` when running under bash(1)
for docset; do
  echo "Remove $docset docset [y/N]" | xargs -p | grep -q . || continue

  rootname="$DASHT_DOCSETS_DIR/$docset"
  rm -f -r "$rootname".docset \
           "$rootname".tgz
done
